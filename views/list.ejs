<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>To-Do App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  </head>
  <body>
    <!-- nav bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">To-Do</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item active">
              <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Write</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Hmm...</a>
          </ul>
        </div>
      </nav>
      
<!-- show to-do -->
      <h3 class="ml-2 my-3">Cehck-list</h3>

        <ul class="list-group">
          <% for(var i=0; i<posts.length; i++){   %>
            <li class="list-group-item">
              <p>no. <%= posts[i]._id %></p>
              <h4>Do: <%= posts[i].Title %></h4>
              <h5>detail: <%= posts[i].Detail %></h5>
              <p>until: <%= posts[i].Date %></p>
              <button class="btn btn-primary delete-btn" data-id="<%= posts[i]._id %>">Delete</button>
            </li>
          <% } %>
        </ul>

<!-- Delete button AJAX -->
      <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
      <script>

        $('.delete-btn').click((e)=>{
          var post_no = e.target.dataset.id; //clicked element's data-id
          var now_selected = $(this);
          $.ajax({
            method: 'DELETE',
            url: '/delete',
            data: {_id : post_no}
          }).done((result)=>{
            console.log('Delete Success!');
            // refresh page by force OR >disablied li element<
            now_selected.parent('li').fadeOut();

          }).fail((xhr, textStatus, errorThrown)=>{
              console.log(xhr,textStatus,errorThrown);
          });
          
        });


      </script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js" integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js" integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ" crossorigin="anonymous"></script>
  </body>
</html>